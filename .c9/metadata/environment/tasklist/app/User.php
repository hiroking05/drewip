{"filter":false,"title":"User.php","tooltip":"/tasklist/app/User.php","undoManager":{"mark":10,"position":10,"stack":[[{"start":{"row":32,"column":5},"end":{"row":33,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":33,"column":0},"end":{"row":33,"column":4},"action":"insert","lines":["    "]},{"start":{"row":33,"column":4},"end":{"row":34,"column":0},"action":"insert","lines":["",""]},{"start":{"row":34,"column":0},"end":{"row":34,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":34,"column":4},"end":{"row":42,"column":5},"action":"insert","lines":["public function followings()","    {","        return $this->belongsToMany(User::class, 'user_follow', 'user_id', 'follow_id')->withTimestamps();","    }","","    public function followers()","    {","        return $this->belongsToMany(User::class, 'user_follow', 'follow_id', 'user_id')->withTimestamps();","    }"],"id":3}],[{"start":{"row":42,"column":5},"end":{"row":43,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":43,"column":0},"end":{"row":43,"column":4},"action":"insert","lines":["    "]},{"start":{"row":43,"column":4},"end":{"row":44,"column":0},"action":"insert","lines":["",""]},{"start":{"row":44,"column":0},"end":{"row":44,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":44,"column":4},"end":{"row":81,"column":5},"action":"insert","lines":["public function follow($userId)","    {","        // 既にフォローしているかの確認","        $exist = $this->is_following($userId);","        // 相手が自分自身ではないかの確認","        $its_me = $this->id == $userId;","    ","        if ($exist || $its_me) {","            // 既にフォローしていれば何もしない","            return false;","        } else {","            // 未フォローであればフォローする","            $this->followings()->attach($userId);","            return true;","        }","    }","    ","    public function unfollow($userId)","    {","        // 既にフォローしているかの確認","        $exist = $this->is_following($userId);","        // 相手が自分自身ではないかの確認","        $its_me = $this->id == $userId;","    ","        if ($exist && !$its_me) {","            // 既にフォローしていればフォローを外す","            $this->followings()->detach($userId);","            return true;","        } else {","            // 未フォローであれば何もしない","            return false;","        }","    }","    ","    public function is_following($userId)","    {","        return $this->followings()->where('follow_id', $userId)->exists();","    }"],"id":5}],[{"start":{"row":81,"column":5},"end":{"row":82,"column":0},"action":"insert","lines":["",""],"id":6},{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"insert","lines":["    "]},{"start":{"row":82,"column":4},"end":{"row":83,"column":0},"action":"insert","lines":["",""]},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":83,"column":4},"end":{"row":88,"column":5},"action":"insert","lines":["public function feed_microposts()","    {","        $follow_user_ids = $this->followings()->pluck('users.id')->toArray();","        $follow_user_ids[] = $this->id;","        return Micropost::whereIn('user_id', $follow_user_ids);","    }"],"id":7}],[{"start":{"row":83,"column":34},"end":{"row":83,"column":35},"action":"remove","lines":["s"],"id":8},{"start":{"row":83,"column":33},"end":{"row":83,"column":34},"action":"remove","lines":["t"]},{"start":{"row":83,"column":32},"end":{"row":83,"column":33},"action":"remove","lines":["s"]},{"start":{"row":83,"column":31},"end":{"row":83,"column":32},"action":"remove","lines":["o"]},{"start":{"row":83,"column":30},"end":{"row":83,"column":31},"action":"remove","lines":["p"]},{"start":{"row":83,"column":29},"end":{"row":83,"column":30},"action":"remove","lines":["o"]},{"start":{"row":83,"column":28},"end":{"row":83,"column":29},"action":"remove","lines":["r"]},{"start":{"row":83,"column":27},"end":{"row":83,"column":28},"action":"remove","lines":["c"]},{"start":{"row":83,"column":26},"end":{"row":83,"column":27},"action":"remove","lines":["i"]},{"start":{"row":83,"column":25},"end":{"row":83,"column":26},"action":"remove","lines":["m"]}],[{"start":{"row":83,"column":25},"end":{"row":83,"column":26},"action":"insert","lines":["t"],"id":9},{"start":{"row":83,"column":26},"end":{"row":83,"column":27},"action":"insert","lines":["a"]},{"start":{"row":83,"column":27},"end":{"row":83,"column":28},"action":"insert","lines":["s"]},{"start":{"row":83,"column":28},"end":{"row":83,"column":29},"action":"insert","lines":["k"]},{"start":{"row":83,"column":29},"end":{"row":83,"column":30},"action":"insert","lines":["s"]}],[{"start":{"row":87,"column":23},"end":{"row":87,"column":24},"action":"remove","lines":["t"],"id":10},{"start":{"row":87,"column":22},"end":{"row":87,"column":23},"action":"remove","lines":["s"]},{"start":{"row":87,"column":21},"end":{"row":87,"column":22},"action":"remove","lines":["o"]},{"start":{"row":87,"column":20},"end":{"row":87,"column":21},"action":"remove","lines":["p"]},{"start":{"row":87,"column":19},"end":{"row":87,"column":20},"action":"remove","lines":["o"]},{"start":{"row":87,"column":18},"end":{"row":87,"column":19},"action":"remove","lines":["r"]},{"start":{"row":87,"column":17},"end":{"row":87,"column":18},"action":"remove","lines":["c"]},{"start":{"row":87,"column":16},"end":{"row":87,"column":17},"action":"remove","lines":["i"]},{"start":{"row":87,"column":15},"end":{"row":87,"column":16},"action":"remove","lines":["M"]}],[{"start":{"row":87,"column":15},"end":{"row":87,"column":16},"action":"insert","lines":["T"],"id":11},{"start":{"row":87,"column":16},"end":{"row":87,"column":17},"action":"insert","lines":["a"]},{"start":{"row":87,"column":17},"end":{"row":87,"column":18},"action":"insert","lines":["s"]},{"start":{"row":87,"column":18},"end":{"row":87,"column":19},"action":"insert","lines":["k"]}],[{"start":{"row":33,"column":0},"end":{"row":89,"column":0},"action":"remove","lines":["    ","    public function followings()","    {","        return $this->belongsToMany(User::class, 'user_follow', 'user_id', 'follow_id')->withTimestamps();","    }","","    public function followers()","    {","        return $this->belongsToMany(User::class, 'user_follow', 'follow_id', 'user_id')->withTimestamps();","    }","    ","    public function follow($userId)","    {","        // 既にフォローしているかの確認","        $exist = $this->is_following($userId);","        // 相手が自分自身ではないかの確認","        $its_me = $this->id == $userId;","    ","        if ($exist || $its_me) {","            // 既にフォローしていれば何もしない","            return false;","        } else {","            // 未フォローであればフォローする","            $this->followings()->attach($userId);","            return true;","        }","    }","    ","    public function unfollow($userId)","    {","        // 既にフォローしているかの確認","        $exist = $this->is_following($userId);","        // 相手が自分自身ではないかの確認","        $its_me = $this->id == $userId;","    ","        if ($exist && !$its_me) {","            // 既にフォローしていればフォローを外す","            $this->followings()->detach($userId);","            return true;","        } else {","            // 未フォローであれば何もしない","            return false;","        }","    }","    ","    public function is_following($userId)","    {","        return $this->followings()->where('follow_id', $userId)->exists();","    }","    ","    public function feed_tasks()","    {","        $follow_user_ids = $this->followings()->pluck('users.id')->toArray();","        $follow_user_ids[] = $this->id;","        return Task::whereIn('user_id', $follow_user_ids);","    }",""],"id":12,"ignore":true}]]},"ace":{"folds":[],"scrolltop":1217,"scrollleft":0,"selection":{"start":{"row":33,"column":0},"end":{"row":33,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1573902933023,"hash":"e27086ecbcebd34a0e16663d694cfaac7b317c6e"}